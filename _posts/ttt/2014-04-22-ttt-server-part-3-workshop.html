---
layout: post
title:  "TTT Dedicated Server Part 3: Integration des Steam Workshop"
author: Simon Müller
date:   2014-04-22 21:30:33 +0100
categories: TTT-Server
image: assets/gm-mods.png
showtoc: true
---

In diesem Teil soll es nun wie bereits angekündigt darum gehen, unserem Server ein wenig Leben in Form von Steam-Workshop-Inhalten wie neuen Waffen, Funktionen – oder dem allerwichtigsten: zusätzlichen Maps! - einzuhauchen.

<h2>Steam API-Key besorgen</h2>
<h2></h2>
Um mit eurem Server auf den Steam Workshop zugreifen zu können, braucht ihr zunächst einen Steam API-Key. Diesen könnt ihr euch unter <a title="http://steamcommunity.com/dev/apikey" href="http://steamcommunity.com/dev/apikey">http://steamcommunity.com/dev/apikey</a> generieren lassen.

Für welchen Zweck man hier einen Domainnamen eingeben muss, erschließt sich mir hier nicht so ganz, soweit ich weiß ist dieser allerdings auch nicht weiter von Bedeutung. Wenn ihr wie im ersten Teil empfohlen eine no-ip-Domain angelegt habt, könnt ihr beispielsweise diese nutzen. Ansonsten könnt ihr soviel ich weiß aber auch jede andere Domain eingeben (<a href="https://www.youtube.com/watch?v=saCof9QqjnA">In diesem Tutorial</a> zum Beispiel wird steamidfinder.com als Domain genutzt).

Nach Bestätigung der Eingabe erhaltet ihr einen 32 Zeichen langen Schlüssel aus Zahlen und Großbuchstaben, den ihr euch am besten zunächst in einer Textdatei abspeichert.
<h2>Eine Workshop-Kollektion anlegen</h2>
<em><strong>Hinweis:</strong> Bevor ihr die Kollektion erstellt, abonniert am besten im Workshop ein beliebiges Garry’s Mod- Objekt – sonst kann es unter umständen zu Problemen bei der Einrichtung kommen.</em>

Nun müsst ihr euch noch eine Workshop-Kollektion anlegen, in die von nun an alle Addons gepackt werden, welche auf eurem Server laufen sollen. Dieser Prozess ist eigentlich ziemlich selbsterklärend:

<a href="http://steamcommunity.com/workshop/browse/?appid=4000&amp;section=collections">Im Workshop zu Garry’s Mod geht ihr in den Kollektions-Tab</a> und klickt rechts auf “Kollektion erstellen”.  Ihr werdet nun durch eine Einrichtung geführt (Eigentlich ist alles, was ihr hier eingebt und auswählt ziemlich egal – nur beim Punkt <em>“Um welche Art von Kollektion handelt es sich?”</em> solltet ihr <em>“Objekte, die zusammenpassen (zeigt einen "Alle abonnieren"-Knopf)”</em> auswählen), welche eigentlich ziemlich selbsterklärend ist.

Nach einem klick auf Speichern und Fortfahren, habt ihr die Möglichkeit, jetzt schon Objekte zur Kollektion hinzuzufügen. Diesen Schritt überspringen wir aber zunächst, da dies später noch genauso gut möglich ist (<strong>Ein</strong> Objekt <strong>müssen </strong>wir leider hinzufügen, um mit der Einrichtung überhaupt weitermachen zu dürfen – hier kommt das am Anfang des Abschnitts abonnierte Objekt ins Spiel – im Tab Abonnierte Objekte könnt ihr dieses in die Kollektion holen – keine Angst, später kann es auch wieder daraus entfernt werden).

Ein weiterer Klick auf Speichern und Fortfahren bringt uns zum vorerst letzten Schritt bei der Einrichtung: wir sollen ein Hintergrundbild hochladen – auch hier ist eigentlich egal, was ihr hochladet, ihr solltet nur aufpassen, dass ihr bei keinem hochgeladenen Bild die Rechte anderer verletzt (Copyright, Bilder von anderen Personen, …) und auch ein Bild von der letzten Party ist eher fehl am Platz – zur Not legt ihr mit Paint ein reinweises Bild an und ladet dieses hoch.

Nach einem Klick auf den "Veröffentlichen"-Button seid ihr fertig (<strong>Das Veröffentlichen ist wichtig!</strong> Sonst kann der Server eure Kollektion nicht abrufen).

Nun könnt ihr nach belieben im Workshop nach Addons und Maps stöbern, die ihr auf dem Server nutzen wollt und diese via dem Button “Zur Kollektion hinzufügen” auf den Server packen. Verzichtet dabei aber darauf, andere Kollektionen mit einzubinden, sondern holt euch lieber alle Addons dieser Kollektionen einzeln - mit verlinkten Kollektionen scheint der Server Probleme zu haben.
<h2>Das Serverstartscript anpassen</h2>
Da der Server von alledem ja noch nichts mitbekommen hat, müssen wir ihm nun noch mitteilen, welche Kollektion er denn nutzen soll. Hierzu braucht ihr noch die ID eurer Kollektion. Diese findet ihr heraus, indem ihr eure Kollektion in eurem Browser aufruft und euch die URL anschaut. Lautet diese zum Beispiel <a title="http://steamcommunity.com/sharedfiles/filedetails/?id=251913754" href="http://steamcommunity.com/sharedfiles/filedetails/?id=251913754">http://steamcommunity.com/sharedfiles/filedetails/?id=251913754</a>, dann ist die ID eurer Kollektion 251913754.

Nun müsst ihr eurem Server noch euren frisch generierten API-Key und die ID der Kollektion mitteilen. Dies geschieht im Startscript über weitere Parameter:

<code class="inline">+host_workshop_collection</code> für die ID eurer Kollektion und <code class="inline">-authkey</code> für den oben frisch generierten Identifikationsschlüssel.

Habt ihr bisher also aus <a href="https://e-smog.org/blog/garrys-mod-ttt-dedicated-server-erstellenpart-2/">Tutorial Nr. 2</a> noch folgendes in eurem Startscript stehen:
<pre>srcds.exe -console -maxplayers 16 -game garrysmod +gamemode terrortown +map gm_construct</pre>
so wird das mit den passenden Ergänzungen zu
<pre>srcds.exe -console -maxplayers 16 -game garrysmod +gamemode terrortown +map gm_construct -authkey XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX +host_workshop_collection XXXXXXXXX</pre>
Die XXXX müsst ihr natürlich dabei jeweils durch euren Key und eure Kollektions-ID ersetzen.

Wenn ihr bereits ein paar Maps in eurer Kollektion habt, könnt ihr bei dieser Gelegenheit auch gleich eine von ihnen als Startmap festlegen. Statt <code class="inline">+map gm_construct</code> schreibt ihr einfach <code class="inline">+map EUER_MAPNAME</code>

Ein Beispiel aus meiner Serverkonfiguration wäre hier: <code class="inline">+map ttt_minecraft_b5</code>
<h2> Workshopdownload erzwingen</h2>
Es kann bei manchen Workshoppaketen vorkommen, dass diese von den Clients der Mitspieler nicht heruntergeladen werden, obwohl sie eigentlich im Spiel benötigt werden. Dies ist besonders häufig der Fall bei Content-Addons, wie sie zum Beispiel für den Pointshop benötigt werden. Die Folge ist, dass Texturen fehlen, Spieler als Error-Nachrichten herumlaufen oder ebendiese wild auf der Map verteilt herumliegen, was bisweilen ganz schön stören kann.

Mit einer kleinen Datei könnt ihr jedoch den Download dieser Pakete bei den Clients erzwingen. Beachtet dabei aber bitte, dass die Addons dann auf jeden Fall immer von allen komplett heruntergeladen werden müssen - eure Maps solltet ihr in die Liste also nicht mit aufnehmen, die werden normalerweise automatisch heruntergeladen und würden sonst den ersten Serverbeitritt eines potentiellen Mitspielers zur Qual machen.
<h3>Wie gehts?</h3>
Um den Download der Pakete zu erzwingen benötigt ihr eine lua-Datei, deren Inhalt auf jeden Fall beim Serverstart ausgeführt wird.
<h4 id="forcedownloadtool">Halbautomatischer Weg</h4>
Um diesen Vorgang zu erleichtern habe ich ein kleines Tool geschrieben, in dem ihr bequem per Häkchen auswählen könnt, für welche Addons der Download erzwungen werden soll. Das Tool generiert euch daraufhin dann den Quelltext, den ihr mit der nachfolgenden manuellen Methode komplett von Hand erzeugen müsstet.

[download id="1424"]
<h4>Manueller Weg</h4>
Am einfachsten geht das, wenn ihr im Unterordner /garrysmod/lua/autorun/server eine neue Lua-Datei mit beliebigem Namen erstellt. Die Dateien in diesem Ordner werden alle auf jeden Fall auf dem Server beim Starten ausgeführt.

Als Inhalt bekommt die Datei nun nur Zeilen nach dem folgenden Format:
<code class="inline">resource.AddWorkshop( "workshopid" )</code><small><a href="http://wiki.garrysmod.com/page/resource/AddWorkshop" target="_blank" rel="noopener">[1]</a></small>

Anstatt "workhopid" müsst ihr für jedes Addon, dessen Download ihr erzwingen wollt dessen ID in Anführungszeichen einfügen.

Wenn also die URL eines Addons im Workshop http://steamcommunity.com/sharedfiles/filedetails/?id=1234567 lautet, müsstet ihr die folgende Zeile einfügen, um dessen Download zu erzwingen:

<code>resource.AddWorkshop( "1234567" )</code>

mit ein paar mehr Addons sähe das dann so aus:
<code>
resource.AddWorkshop( "1234567" ) --Pedobär Playermodel Version 1337
resource.AddWorkshop( "89101112" ) --Supermegatolle Spezialwaffe
resource.AddWorkshop( "13141516" ) --Total lächerlicher Hut für Pointshop
</code>

Wie ihr seht habe ich mittels zwei Bindestrichen hinter jede Zeile einen Kommentar gesetzt, welcher das Addon kurz beschreibt. Das macht das aktualisieren und Warten der Liste erheblich einfacher, da man nicht einfach nur vor einem Haufen Zahlen sitzt, sondern auf einen Blick sieht, um welches Addon es sich bei der jeweiligen Zeile handelt. Wenn ihr diese Datei nun abspeichert und euren Server neu startet, sollten von nun an alle Clients die spezifizierten Addons beim ersten Serverbeitritt herunterladen.
<h2>Welche Addons sind für den Start sinnvoll?</h2>
Ihr solltet von Anfang an darauf achten, euren Server – so cool die ganzen Addons auch klingen – nicht zu überladen. Sonst wird es für potentielle Spieler eine Qual, sich das erste Mal mit eurem Server zu verbinden, wenn sie zunächst 2 Stunden Workshop-Content herunterladen müssen, anstatt direkt losspielen zu können.

Deshalb hier eine kleine Liste von Addons, die auf einem TTT-Server durchaus sinnvoll sind:
<h4>Addons:</h4>
<ul>
 	<li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=151583504">Mapvote</a> – Der Name sagt alles. Anstatt immer von Hand in der Serverkonsole die Map ändern zu müssen, wird nach der Runde eine Liste mit Maps angezeigt, über die die Spieler abstimmen können.</li>
 	<li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=194965598">TTT Weapon Collection</a> – macht das Spiel durch zusätzliche Waffen – auch für Traitors und Detectives - etwas abwechslungsreicher.</li>
 	<li><a title="Garrys mod TTT Dedicated Server erstellen – Part 6: Serveradministration mit ULX und ULib" href="https://e-smog.org/blog/garrys-mod-ttt-server-erstellen-part-6-serveradministration-mit-ulx-und-ulib/">ULX </a>- Ein Addon zum administrieren des Servers. Von der kompletten Neukonfiguration des Servers (nur während einer Runde) bis zu einem Mapwechsel ist alles mit wenigen Mausklicks machbar. <em>Die aktuelle Version des Addons sollte man sich auf jeden Fall auf der Herstellerseite herunterladen und nicht über den Steam Workshop, deshalb verlinke ich hier auf einen weiteren Teil dieser Artikelserie, wo die Installation von ULX genau erklärt wird.</em></li>
</ul>
<h4>Maps:</h4>
<ul>
 	<li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=148364870">TTT Map Pack</a> – ein guter Anfangsbestand an Maps, auf den man aufbauen kann.</li>
 	<li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=159321088">ttt_minecraft_b5</a> – Tolle Map, es bleibt eigentlich immer spannend, ohne, dass sich alle an einem Punkt versammeln.</li>
 	<li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=176887855">ttt_mw2_terminal</a> – Für alle die gerne COD:MW2 gespielt haben: TERMINAL! Muss ich noch mehr sagen? (Auch wenn die etwas eckige Optik ein bisschen gewöhnungsbedürftig ist</li>
 	<li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=434164467">ttt_rooftops_a2_f1</a> – eine durch die wenigen Verbindungen zwischen den Dächern immer sehr spannende Map – die Traitors haben viele Sniper-Möglichkeiten und können versteckt hinter einem Hausdach oder einer Ecke auch mal einen Innocent killen, ohne sofort aufzufliegen.</li>
 	<li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=163347610">ttt_whitehouse_b2</a> – Ebenfalls sehr viele Möglichkeiten, sich zu verteilen und damit gute Chancen für die Traitors ohne dabei zu unausgewogen zu werden.</li>
 	<li><a href="http://steamcommunity.com/sharedfiles/filedetails/?id=141103402">ttt__bb_teenroom_b2</a> – durch die einzelne Sniperposition auf dem Schrank leider etwas unausgewogene aber dennoch immer wieder lustige Map in einem riesigen Kinderzimmer – bietet viele kleine vernetzte Gänge durch Mäuselöcher in der Wand und im Lüftungssystem.</li>
</ul>
Wer weitere Vorschläge für gute Maps/Addons hat, kann diese gerne in den Kommentaren nennen, eventuell nehme ich sie dann in die Liste mit auf.

<hr />
<p style="text-align: center;"> <em><strong>NOCH FRAGEN?</strong></em></p>
<p style="text-align: center;"><em>Schau dir doch mal die <a title="Garrys mod TTT Dedicated Server erstellen – Part 7: F.A.Q/Troubleshooting" href="https://e-smog.org/blog/garrys-mod-ttt-dedicated-server-erstellen-part-7-f-a-q/">FAQ </a>an, vielleicht wurde deine Frage bereits beantwortet. Wenn nicht, schreibe mir gerne in den Kommentaren.</em></p>
<p style="text-align: center;"><em>Weiter gehts in <a title="Garrys mod TTT Dedicated Server erstellen – Part 4: Andere Spiele “mounten”" href="https://e-smog.org/blog/garrys-mod-ttt-dedicated-server-erstellen-part-4-andere-spiele-mounten/">Part 4</a> mit dem Mounten der Dateien aus CounterStrike: Source</em></p>